<h1 align="center">
    <a href="https://trackmage.com" target="_blank">
        <img src="https://trackmage.com/landing/img/email_logo_46h.png" />
    </a>
</h1>

# TrackMage SDK for php

[![Build Status](https://travis-ci.org/trackmage/trackmage-sdk-php.svg?branch=master)](https://travis-ci.org/trackmage/trackmage-sdk-php)
[![Total Downloads](https://poser.pugx.org/trackmage/trackmage-sdk-php/downloads)](https://packagist.org/packages/trackmage/trackmage-sdk-php)

TrackMage is your most automated shipment tracking tool ever.
Discover the simple way to show your customers where their parcels are, provide support and get more great reviews


## Getting Started

1. **Create a TrackMage account** – First of all, you need to
   [sign up](https://app.trackmage.com) for a TrackMage account
   and retrieve your clientId and clientSecret.
1. **Minimum requirements** – To run the SDK you need to have installed **PHP >= 5.6**.
   We highly recommend using v7.2 or higher. 
1. **Install the SDK** – Using [Composer] is the recommended way to install the
   TrackMage SDK for PHP. The SDK is available on Packagist as the
   [`trackmage/trackmage-sdk-php`](http://packagist.org/packages/trackmage-sdk-php) package
   ```
   composer require trackmage/trackmage-sdk-php
   ```
1. **See the docs** There are [API documentation](https://api.trackmage.com/) and [the generated API client docs](docs)

## Quick examples

### Create a client

```
use TrackMage\Client\TrackMageClient;

$clientId = '<client-it>';
$clientSecret = '<client-secret>';
$client = new TrackMageClient($clientId, $clientSecret);
$client->setHost('https://api.stage.trackmage.com'); //optionally
$client->setLogger(new NullLogger()); //optionally
```

### Posting a tracking number

```
$workspaceId = 100;

$shipment = new ShipmentPost();
$shipment->setTrackingNumber('TN-1');
$shipment->setWorkspace('/workspaces/'.$workspaceId);
$shipment = $client->getTrackingNumberApi()->postTrackingNumberCollection($shipment);

$items = $client->getTrackingNumberApi()->apiWorkspacesTrackingNumbersGetSubresource($workspaceId);
```

### Get workspaces list

```
$workspaces = $client->getWorkspaceApi()->getWorkspaceCollection();
```

### Get carriers list

```
$carriers = self::$client->getCarrierApi()->getCarrierCollection();
```

### Create webhook

Here is [the webhook handler example](examples/webhook-handler.php) that you need to make accessible on your side.

```php
<?php
$workflow = [
    'type' => 'webhook',
    'period' => 'immediately',
    'title' => 'Webhook for testing',
    'workspace' => '/workspaces/<id>',
    'enabled' => true,
    'concurrency' => '1',
    'url' => 'http://acme.example',
    'authType' => 'basic',
    'username' => 'webhook_user',
    'password' => 'password',
    'notificationEmails' => [
        'test@email.com', 'test-2@email.com',
    ],
];
$response = $client->getGuzzleClient()->post(
    '/workflows', ['json' => $workflow]
);

$data = json_decode($response->getBody()->getContents(), true);
$workflowId = $data['id'];
```

## Tests

To run the unit tests:

```bash
composer update
./vendor/bin/phpunit
```


## API Generation


This PHP package is automatically generated by the [OpenAPI Generator](https://github.com/OpenAPITools/openapi-generator) project:

### How to generate:

Download [OpenAPI Generator CLI](https://mvnrepository.com/artifact/org.openapitools/openapi-generator-cli):
```
wget https://repo1.maven.org/maven2/org/openapitools/openapi-generator-cli/4.3.1/openapi-generator-cli-4.3.1.jar -O openapi-generator-cli.jar
``` 

and run the following:
```
rm -rf ./lib/* ./docs/*
java -jar openapi-generator-cli.jar generate \
   -i https://api.l.trackmage.com/docs.json \
   -g php \
   -c .openapi-config.json \
   --skip-validate-spec \
   -o .
```

where `-c .openapi-config.json` is config with php options. See all options:
```
java -jar openapi-generator-cli.jar config-help -l php
```


Fix duplicate arguments:
```
find ./lib/Api/ -name '*.php' -print | php .openapi-generator/dupe_args_fixer.php --fix
```
